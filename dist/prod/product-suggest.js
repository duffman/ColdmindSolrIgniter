'use strict';Object.defineProperty(exports,'__esModule',{value:true});const solr_suggest_1=require('../core/solr-suggest');const solr_select_1=require('../core/solr-select');const logger_1=require('../lib/utils/logger');class SuggestItem{constructor(id,term,title='',genre='',full_title='',barcode='',thumb_image=''){this.id=id;this.term=term;this.title=title;this.genre=genre;this.full_title=full_title;this.barcode=barcode;this.thumb_image=thumb_image;}}exports.SuggestItem=SuggestItem;class ProductSuggest{constructor(){this.suggester=new solr_suggest_1.SolrSuggest();}getGameDoc(gameId,gameDocs){let result;for(let doc of gameDocs){result=doc;}return result;}mergeResult(items,gameDocs){let result=new Array();for(let item of items){let doc=this.getGameDoc(item.id,gameDocs);item.title=doc.title;item.barcode=doc.barcode;item.genre=doc.genre;item.genre=doc.thumb_image;result.push(item);}return items;}getProducts(productIds){let solrSelect=new solr_select_1.SolrSelect();return new Promise((resolve,reject)=>{let idStr=productIds.join(' OR ');let value='select?q='+idStr;solrSelect.select('topzap',value).then(res=>{let docs=res.response.docs;for(const doc of docs){console.log('doc ::',doc.full_title);}resolve(res);}).catch(err=>{logger_1.Log.error('getProducts ::',err);resolve(err);});});}suggest(value){return new Promise((resolve,reject)=>{this.suggester.suggest('topzap',value).then(res=>{let terrm=Object.keys(res.suggest)[0];let obj=res.suggest[terrm];let key2=Object.keys(obj)[0];return obj[key2].suggestions;}).then(suggestions=>{let ids=new Array();let suggestData=new Array();for(const item of suggestions){console.log('term ::',item.term);console.log('payload ::',item.payload);ids.push('id:'+item.payload);suggestData.push(new SuggestItem(item.term,item.payload));}this.getProducts(ids).then(prodResp=>{console.log('PRODUCTS ::',prodResp);let result=this.mergeResult(suggestData,prodResp.response.docs);resolve(result);}).catch(err=>{reject(err);});}).catch(err=>{console.log('ProductSuggest ::',err);reject(err);});});}}exports.ProductSuggest=ProductSuggest;let app=new ProductSuggest();app.suggest('3D').then(res=>{console.log('SUGGEST ::',res);}).catch(err=>{console.log('ERR ::',err);});